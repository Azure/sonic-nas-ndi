<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE CLISH_MODULE [
<!ENTITY SUBTREE_FILTER "Filter_Type:SUBTREE">
<!ENTITY NAMESPACE_FILTER  "Filter_Namespace:http://www.dellemc.com/networking/os10/dell-iscsi-autoconf">
<!ENTITY ISCSI_NS     "http://www.dellemc.com/networking/os10/dell-iscsi-autoconf">
<!ENTITY ISCSI-PREF   "dell-iscsi-autoconf">
<!ENTITY ISCSI_NS_PREF     "&ISCSI-PREF;=http://www.dellemc.com/networking/os10/dell-iscsi-autoconf">
<!ENTITY ISCSI_INTF_NS "urn:ietf:params:xml:ns:yang:ietf-interfaces,&ISCSI_NS_PREF;">
<!ENTITY INTF_CONFIG "/interfaces/interface">
<!ENTITY INTF_STATUS "/interfaces-state/interface">
<!ENTITY ISCSI_INTF_CONFIG  "/interfaces/interface/&ISCSI-PREF;:iscsi-cfg">
<!ENTITY ISCSI_INTF_NAME "&INTF_CONFIG;/name=${ifacename}">
<!ENTITY ISCSI_LAG_NAME "&INTF_CONFIG;/name=${port-channeliface}">
<!ENTITY ISCSI_RANGE_IF_ENTRY  "/interfaces/interface[]">
<!ENTITY ISCSI_RANGE_IF_NAME   "&ISCSI_RANGE_IF_ENTRY;/name=${ifacename}">
<!ENTITY ISCSI_RANGE_IF_CONFIG  "&ISCSI_RANGE_IF_ENTRY;/&ISCSI-PREF;:iscsi-cfg">
<!ENTITY ISCSI_RANGE_LAG_NAME "&ISCSI_RANGE_IF_ENTRY;/name=${portchanliface}">
<!ENTITY ISCSI_GLOBAL_CONFIG "/global-iscsi-cfg">
<!ENTITY ISCSI_GLOBAL_CONFIG_ENABLE "&ISCSI_GLOBAL_CONFIG;/enable">
<!ENTITY ISCSI_OPT_NS       "dell-iscsi-optimization=http://www.dellemc.com/networking/os10/dell-iscsi-optimization">
<!ENTITY ISCSI_CFG          "/iscsi-cfg">
<!ENTITY ISCSI_OPER         "/iscsi-oper">
<!ENTITY ISCSI_COS          "/iscsi-cos">
<!ENTITY ISCSI_PORT_KEY     "&ISCSI_CFG;/target/port">
<!ENTITY ISCSI_TARGET       "&ISCSI_CFG;/target[]">
<!ENTITY ISCSI_IP_KEY       "&ISCSI_CFG;/target/ip-addresses">
<!ENTITY ISCSI_TARGET_IP    "&ISCSI_TARGET;/ip-addresses[]">
<!ENTITY ISCSI_OPT_NS_FIL   "Filter_Namespace:&ISCSI_OPT_NS;">
<!ENTITY ISCSI_OPT_MODULE_NS "http://www.dellemc.com/networking/os10/dell-iscsi-optimization">
]>
<CLISH_MODULE
    xmlns="http://www.dellemc.com/force10/XMLSchema"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:xi="http://www.w3.org/2001/XInclude"
    xsi:schemaLocation="http://www.dellemc.com/force10/XMLSchema
    http://www.dellemc.com/force10/XMLSchema/clish.xsd"
    >
    <!--=======================================================-->
    <!--                EXEC MODE                              -->
    <!--=======================================================-->
    <VIEW
        name="enable-view"
        >
       <!-- show iscsi -->
        <COMMAND
            name="show iscsi"
            help="Show iscsi"
            operation="get"
            namespace="&ISCSI_NS_PREF;,&ISCSI_OPT_NS;"
            yang_filter="&SUBTREE_FILTER;;Filter_Conditions:&ISCSI_CFG;;&ISCSI_OPT_NS_FIL;|&SUBTREE_FILTER;;Filter_Conditions:&ISCSI_COS;;&ISCSI_OPT_NS_FIL;|&SUBTREE_FILTER;;Filter_Conditions:&ISCSI_GLOBAL_CONFIG_ENABLE;;&NAMESPACE_FILTER;|&SUBTREE_FILTER;;Filter_Conditions:&ISCSI_OPER;;&ISCSI_OPT_NS_FIL;"
            template="show_iscsi.xsl">
            <PARAM
                name="iscsi options"
                help="iscsi options"
                optional="true"
                ptype="SUBCOMMAND"
                mode="switch">
                <!-- show iscsi storage-devices -->
                <PARAM
                    name="storage-devices"
                    help="Show iscsi storage-devices"
                    ptype="SUBCOMMAND"
                    mode="subcommand"
                    optional="true"
                    template="show_iscsi_storage_devices.xsl"
                    yang_filter="&SUBTREE_FILTER;;Filter_Conditions:&INTF_STATUS;/dell-iscsi-autoconf:iscsi-status;Filter_Namespace:&ISCSI_INTF_NS;"/>
                <PARAM
                    name="session"
                    help="Display iSCSI Sessions"
                    ptype="SUBCOMMAND"
                    mode="subcommand"
                    optional="true"
                    template="show_iscsi_session.xsl"
                    yang_filter="&SUBTREE_FILTER;;Filter_Conditions:&ISCSI_OPER;;Filter_Namespace:&ISCSI_OPT_NS;">
                    <PARAM
                        name="detailed"
                        help="Display detailed session information"
                        ptype="SUBCOMMAND"
                        mode="subcommand"
                        optional="true"
                        template="show_iscsi_session_detail.xsl"
                        yang_filter="&SUBTREE_FILTER;;Filter_Conditions:&ISCSI_OPER;;Filter_Namespace:&ISCSI_OPT_NS;">
                        <PARAM
                            name="isid"
                            help="Display information for particular iscsi session"
                            ptype="SUBCOMMAND"
                            mode="subcommand"
                            optional="true">
                            <PARAM
                                 name="isid_value"
                                 help="ISID of session"
                                 ptype="ISID_VALUE"
                                 template="show_iscsi_session_detail.xsl"
                                 yang_filter="&SUBTREE_FILTER;;Filter_Conditions:&ISCSI_OPER;,
                                 &ISCSI_OPER;/sessions/isid=${isid_value};Filter_Namespace:&ISCSI_OPT_MODULE_NS;"/>
                        </PARAM> <!-- isid -->
                    </PARAM> <!-- detailed -->
                </PARAM> <!-- session -->
            </PARAM> <!-- show iscsi options -->
        <ACTION builtin="clish_extn" />
        </COMMAND>
    </VIEW>
    <!--=======================================================-->
    <!--                Config MODE                            -->
    <!--=======================================================-->
    <VIEW
        name="configure-view"
        >
        <!--iscsi enable-->

                <COMMAND
                    name="iscsi"
                    help="enable iscsi globally"
                    operation="edit-config"
                    namespace="&ISCSI_NS;">
                     <PARAM
                         name="enable"
                         help=""
                         ptype="SUBCOMMAND"
                         mode="subcommand"
                         yang_name="&ISCSI_GLOBAL_CONFIG_ENABLE;=true">
                      </PARAM>
                    <ACTION  builtin="clish_extn" > </ACTION>
                </COMMAND>
        <!--iscsi [ priority-bits | target | session-monitoring | aging ] -->
        <COMMAND
            name="iscsi priority-bits"
            help="Configure ISCSI priority bits"
            operation="edit-config"
            namespace="http://www.dellemc.com/networking/os10/dell-iscsi-optimization"
            >
            <PARAM
                name="priority-bits-value"
                help="Priority bitmap"
                ptype="HEX_RANGE_1_FF"
                yang_name="&ISCSI_CFG;/appln-tlv-priority-bits=${priority-bits-value}"
                />
            <ACTION
                builtin="clish_extn"
                ></ACTION>
        </COMMAND>
        <!-- iscsi target [ port | ip-address ] -->
        <COMMAND
            name="iscsi target"
            help="Configure iSCSI Target tcp port on which iSCSI communication happens"
            operation="edit-config"
            namespace="http://www.dellemc.com/networking/os10/dell-iscsi-optimization"
            yang_key="&ISCSI_PORT_KEY;,&ISCSI_IP_KEY;"
            >
            <PARAM
                name="port"
                help="Destination port on which iSCSI communication happens"
                ptype="SUBCOMMAND"
                mode="subcommand"
                >
                <PARAM
                    name="tcp_port_num"
                    help="Comma seperated TCP target ports (Default: 3260,860)"
                    ptype="TCP_PORT"
                    yang_name="&ISCSI_TARGET;/port=${tcp_port_num}"
                    template="iscsi_target_port_err.xsl"
                    >
                    <PARAM
                        name="ip-address"
                        help="Target IP Address"
                        ptype="SUBCOMMAND"
                        mode="subcommand"
                        optional="true"
                        >
                        <PARAM
                            name="addr"
                            help="Target IP Address"
                            ptype="IP_ADDR"
                            yang_name="&ISCSI_TARGET_IP;=${addr}"
                            />
                    </PARAM>
                </PARAM>
            </PARAM>
            <ACTION
                builtin="clish_extn"
                ></ACTION>
        </COMMAND>
        <!-- iscsi session-monitoring enable -->
        <COMMAND
            name="iscsi session-monitoring"
            help="iSCSI session monitoring feature"
            operation="edit-config"
            namespace="http://www.dellemc.com/networking/os10/dell-iscsi-optimization"
            >
            <PARAM
                name="enable"
                help="Enable iSCSI session monitoring"
                ptype="SUBCOMMAND"
                mode="subcommand"
                yang_name="&ISCSI_CFG;/session-mon-enable=true"
                />
            <ACTION
                builtin="clish_extn"
                ></ACTION>
        </COMMAND>
        <!-- iscsi aging time -->
        <COMMAND
            name="iscsi aging"
            help="Configure iSCSI Aging time"
            operation="edit-config"
            namespace="http://www.dellemc.com/networking/os10/dell-iscsi-optimization"
            >
            <PARAM
                name="time"
                help="Configure iSCSI Aging time"
                ptype="SUBCOMMAND"
                mode="subcommand"
                >
                <PARAM
                    name="age-val"
                    help="Aging time in minutes(default 10 minutes)"
                    ptype="RANGE_5_43200"
                    yang_name="&ISCSI_CFG;/session-mon-aging-time=${age-val}"
                    />
           </PARAM>
           <ACTION
                builtin="clish_extn"
                ></ACTION>
        </COMMAND>

        <!--no iscsi enable-->
                <COMMAND
                    name="no iscsi"
                    help="disable iscsi globally"
                    operation="edit-config"
                    namespace="&ISCSI_NS;">
                     <PARAM
                         name="enable"
                         help=""
                         ptype="SUBCOMMAND"
                         mode="subcommand"
                         yang_name="&ISCSI_GLOBAL_CONFIG_ENABLE;=false">
                      </PARAM>
                    <ACTION  builtin="clish_extn" > </ACTION>
                </COMMAND>
        <!-- no iscsi [priority-bits | target | session-monitoring | aging] -->
        <COMMAND
            name="no iscsi priority-bits"
            help="Set iSCSI priority bits to default value(0x10)"
            operation="edit-config"
            namespace="http://www.dellemc.com/networking/os10/dell-iscsi-optimization"
            yang_name="&ISCSI_CFG;/appln-tlv-priority-bits"
            sub_oper_yang="remove:appln-tlv-priority-bits"
            >
            <ACTION
                builtin="clish_extn"
            ></ACTION>
        </COMMAND>
        <!-- no iscsi target port <port-no> [ip-address <ip-addr>] -->
        <COMMAND
            name="no iscsi target"
            help="Configure ISCSI target information"
            operation="edit-config"
            namespace="http://www.dellemc.com/networking/os10/dell-iscsi-optimization"
            >
            <PARAM
               name="port"
               help="Destination port on which iSCSI communication happens"
               ptype="SUBCOMMAND"
               mode="subcommand"
               >
               <PARAM
                   name="tcp_port_num"
                   help="Comma seperated TCP target ports (Default: 3260,860)"
                   ptype="TCP_PORT"
                   sub_oper_yang="remove:target"
                   yang_key="&ISCSI_PORT_KEY;"
                   yang_name="&ISCSI_TARGET;/port=${tcp_port_num}"
                   >
                   <PARAM
                       name="ip-address"
                       help="Target IP Address"
                       ptype="SUBCOMMAND"
                       mode="subcommand"
                       optional="true"
                       >
                       <PARAM
                           name="addr"
                           help="Target IP Address"
                           ptype="IP_ADDR"
                           prompt_fn="iscsi_del_stale_port"
                           prompt_oper="&SUBTREE_FILTER;;Filter_Conditions:&ISCSI_PORT_KEY;=${tcp_port_num};&ISCSI_OPT_NS_FIL;"
                           yang_key="&ISCSI_IP_KEY;"
                           sub_oper_yang="clear;delete:ip-addresses"
                           yang_name="&ISCSI_TARGET_IP;=${addr}"
                           />
                  </PARAM>
               </PARAM>
             </PARAM>
             <ACTION
                builtin="clish_extn"
            ></ACTION>
        </COMMAND>
        <!--no iscsi session-monitoring -->
        <COMMAND
            name="no iscsi session-monitoring"
            help="Configure ISCSI session-monitoring"
            operation="edit-config"
            namespace="http://www.dellemc.com/networking/os10/dell-iscsi-optimization"
            >
            <PARAM
                name="enable"
                help="Disable iSCSI session-monitoring"
                ptype="SUBCOMMAND"
                mode="subcommand"
                yang_name="&ISCSI_CFG;/session-mon-enable=false"
            />
            <ACTION
                builtin="clish_extn"
            ></ACTION>
        </COMMAND>
        <!--no iscsi aging time -->
        <COMMAND
            name="no iscsi aging"
            help="Set iSCSI aging time to default(10s)"
            operation="edit-config"
            namespace="http://www.dellemc.com/networking/os10/dell-iscsi-optimization"
            >
            <PARAM
                name="time"
                help="Reset iSCSI Aging time"
                ptype="SUBCOMMAND"
                mode="subcommand"
                yang_name="&ISCSI_CFG;/session-mon-aging-time"
                sub_oper_yang="remove:session-mon-aging-time"
                />
            <ACTION
                builtin="clish_extn"
            ></ACTION>
        </COMMAND>
    </VIEW>
    <!--=======================================================-->
    <!--                INTERFACE MODE config                  -->
    <!--=======================================================-->
    <VIEW
        name="configure-if-view"
        >
        <COMMAND name="iscsi"
                 help="Configure iSCSI parameters"/>
        <!--iscsi profile-storage storage-name-->
        <COMMAND name="iscsi profile-storage"
                 help="Configure storage neighbour on the interface"
                 operation="edit-config"
                 namespace="&ISCSI_INTF_NS;">
                  <PARAM
                      name="storage-name"
                      help=""
                      ptype="STRING"
                      yang_name="&ISCSI_INTF_NAME;,&ISCSI_INTF_CONFIG;/&ISCSI-PREF;:storage-device-name=${storage-name}">
                 </PARAM>
                 <ACTION builtin="clish_extn"> </ACTION>
        </COMMAND>

        <COMMAND name="no iscsi"
                 help="Remove/delete iSCSI parameters"/>
        <!--no iscsi profile-storage-->
        <COMMAND name="no iscsi profile-storage"
            help="Unconfigure storage neighbour on the interface"
            operation="edit-config"
            namespace="&ISCSI_INTF_NS;"
            yang_name="&ISCSI_INTF_NAME;,&ISCSI_INTF_CONFIG;/&ISCSI-PREF;:storage-device-name">
            <ACTION builtin="clish_extn"> </ACTION>
        </COMMAND>

    </VIEW>
    <!--=======================================================-->
    <!--                LAG INTERFACE MODE config              -->
    <!--=======================================================-->
    <VIEW
        name="configure-lag-view"
        >
        <COMMAND name="iscsi"
                 help="Configure iSCSI parameters"/>
        <!--iscsi profile-storage storage-name-->
        <COMMAND name="iscsi profile-storage"
                 help="Configure storage neighbour on the interface"
                 operation="edit-config"
                 namespace="&ISCSI_INTF_NS;">
                  <PARAM
                      name="storage-name"
                      help=""
                      ptype="STRING"
                      yang_name="&ISCSI_LAG_NAME;,&ISCSI_INTF_CONFIG;/&ISCSI-PREF;:storage-device-name=${storage-name}">
                 </PARAM>
                 <ACTION builtin="clish_extn"> </ACTION>
        </COMMAND>

        <COMMAND name="no iscsi"
                 help="Remove/delete iSCSI parameters"/>
        <!--no iscsi profile-storage-->
        <COMMAND name="no iscsi profile-storage"
            help="Unconfigure storage neighbour on the interface"
            operation="edit-config"
            namespace="&ISCSI_INTF_NS;"
            yang_name="&ISCSI_LAG_NAME;,&ISCSI_INTF_CONFIG;/&ISCSI-PREF;:storage-device-name">
            <ACTION builtin="clish_extn"> </ACTION>
        </COMMAND>

    </VIEW>
    <!--=======================================================-->
    <!--                INTERFACE RANGE MODE config            -->
    <!--=======================================================-->
    <VIEW
        name="configure-if-range-view"
        >

        <COMMAND name="iscsi"
                 help="Configure iSCSI parameters"/>
        <!--iscsi profile-storage storage-name-->
        <COMMAND name="iscsi profile-storage"
                 help="Configure storage neighbour on the interface"
                 operation="edit-config"
                 namespace="&ISCSI_INTF_NS;">
                  <PARAM
                      name="storage-name"
                      help=""
                      ptype="STRING"
                      yang_name="&ISCSI_RANGE_IF_NAME;,&ISCSI_RANGE_IF_CONFIG;/&ISCSI-PREF;:storage-device-name=${storage-name}">
                 </PARAM>
                 <ACTION builtin="clish_extn"> </ACTION>
        </COMMAND>

        <COMMAND name="no iscsi"
                 help="Remove/delete iSCSI parameters"/>
        <!--no iscsi profile-storage-->
        <COMMAND name="no iscsi profile-storage"
            help="Unconfigure storage neighbour on the interface"
            operation="edit-config"
            namespace="&ISCSI_INTF_NS;"
            yang_name="&ISCSI_RANGE_IF_NAME;,&ISCSI_RANGE_IF_CONFIG;/&ISCSI-PREF;:storage-device-name">
            <ACTION builtin="clish_extn"> </ACTION>
        </COMMAND>

    </VIEW>
    <!--=======================================================-->
    <!--                LAG RANGE MODE config            -->
    <!--=======================================================-->
    <VIEW
        name="configure-lag-range-view"
        >

        <COMMAND name="iscsi"
                 help="Configure iSCSI parameters"/>
        <!--iscsi profile-storage storage-name-->
        <COMMAND name="iscsi profile-storage"
                 help="Configure storage neighbour on the interface"
                 operation="edit-config"
                 namespace="&ISCSI_INTF_NS;">
                  <PARAM
                      name="storage-name"
                      help=""
                      ptype="STRING"
                      yang_name="&ISCSI_RANGE_LAG_NAME;,&ISCSI_RANGE_IF_CONFIG;/&ISCSI-PREF;:storage-device-name=${storage-name}">
                 </PARAM>
                 <ACTION builtin="clish_extn"> </ACTION>
        </COMMAND>

        <COMMAND name="no iscsi"
                 help="Remove/delete iSCSI parameters"/>
        <!--no iscsi profile-storage-->
        <COMMAND name="no iscsi profile-storage"
            help="Unconfigure storage neighbour on the interface"
            operation="edit-config"
            namespace="&ISCSI_INTF_NS;"
            yang_name="&ISCSI_RANGE_LAG_NAME;,&ISCSI_RANGE_IF_CONFIG;/&ISCSI-PREF;:storage-device-name">
            <ACTION builtin="clish_extn"> </ACTION>
        </COMMAND>

    </VIEW>

</CLISH_MODULE>
